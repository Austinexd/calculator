<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculator</title>
    <!-- CSS LINK -->
    <link rel="stylesheet" href="calcu.css" />
  </head>

  <body>
    <table id="calcu">
      <tr>
        <td colspan="12"><input type="text" id="result" /></td>
      </tr>

      <tr>
        <td colspan="12">
          <div class="top-buttons">
            <div>
              <input
                type="button"
                value="MC"
                onclick="dis('mc')"
                onkeydown="myFunction()"
              />
            </div>
            <div>
              <input
                type="button"
                value="MR"
                onclick="dis('mr')"
                onkeydown="myFunction()"
              />
            </div>
            <div>
              <input
                type="button"
                value="M+"
                onclick="dis('m+')"
                onkeydown="myFunction()"
              />
            </div>
            <div>
              <input
                type="button"
                value="M-"
                onclick="dis('m-')"
                onkeydown="myFunction()"
              />
            </div>
            <div>
              <input
                type="button"
                value="MS"
                onclick="dis('ms')"
                onkeydown="myFunction()"
              />
            </div>
            <div>
              <input
                type="button"
                value="M"
                onclick="dis('m')"
                onkeydown="myFunction()"
              />
            </div>
          </div>
        </td>
      </tr>
      <tr></tr>
      <td>
        <input
          type="button"
          value="%"
          onclick="dis('%')"
          onkeydown="myFunction()"
        />
      </td>
      <td>
        <input
          type="button"
          value="CE"
          onclick="clearInput(false)"
          onkeydown="myFunction()"
        />
      </td>
      <td>
        <input type="button" value="C" onclick="clearInput(true)" />
      </td>
      <td>
        <input
          type="button"
          value="back"
          onclick="dis('back')"
          onkeydown="myFunction()"
        />
      </td>
      <tr></tr>
      <td>
        <input type="button" value="1/x" onclick="specialOperations('1/x')" />
      </td>

      <td>
        <input type="button" value="x2" onclick="specialOperations('x2')" />
      </td>
      <td>
        <button
          type="button"
          value="2/x"
          onclick="specialOperations('squareroot')"
        >
          &#8730;x
        </button>
      </td>
      <td>
        <input type="button" value="รท" onclick="solveMath('divide')" />
      </td>
      <tr></tr>
      <td>
        <input type="button" value="7" onclick="displayNum('7')" />
      </td>
      <td>
        <input type="button" value="8" onclick="displayNum('8')" />
      </td>
      <td>
        <input type="button" value="9" onclick="displayNum('9')" />
      </td>
      <td>
        <input type="button" value="*" onclick="solveMath('multiply')" />
      </td>

      <tr>
        <td>
          <input type="button" value="4" onclick="displayNum('4')" />
        </td>
        <td>
          <input type="button" value="5" onclick="displayNum('5')" />
        </td>
        <td>
          <input type="button" value="6" onclick="displayNum('6')" />
        </td>
        <td>
          <input type="button" value="-" onclick="solveMath('minus')" />
        </td>
      </tr>
      <tr>
        <td>
          <input type="button" value="1" onclick="displayNum('1')" />
        </td>
        <td>
          <input type="button" value="2" onclick="displayNum('2')" />
        </td>
        <td>
          <input type="button" value="3" onclick="displayNum('3')" />
        </td>
        <td>
          <input type="button" value="+" onclick="solveMath('add')" />
        </td>
      </tr>

      <tr></tr>
      <td>
        <input
          type="button"
          value="+-"
          onclick="dis('+-')"
          onkeydown="myFunction()"
        />
      </td>
      <td>
        <input type="button" value="0" onclick="displayNum('0')" />
      </td>
      <td>
        <input type="button" value="." onclick="dis('.')" />
      </td>
      <td>
        <input type="button" value="=" onclick="solveMath('equal')" />
      </td>
    </table>
    <script>
      let previousResult;
      let currentOperation;
      let startAgain = false;

      function displayNum(number) {
        if (currentOperation && startAgain) {
          document.getElementById("result").value = number;
          startAgain = false;
        } else {
          const currentVal = document.getElementById("result").value;
          if (currentVal === "0")
            document.getElementById("result").value = number;
          else document.getElementById("result").value += number;
        }
      }

      function solveMath(operation) {
        const result = Number(document.getElementById("result").value);
        let newResult;

        if (!currentOperation) {
          currentOperation = operation;
        }

        switch (currentOperation) {
          case "add":
            if (previousResult && currentOperation !== operation) {
              newResult = previousResult + result;
              previousResult = 0;
            } else currentOperation = "add";
            break;
          case "minus":
            if (previousResult && currentOperation !== operation) {
              newResult = previousResult - result;
              previousResult = 0;
            } else currentOperation = "minus";
            break;
          case "multiply":
            if (previousResult && currentOperation !== operation) {
              newResult = previousResult * result;
              previousResult = 0;
            } else currentOperation = "multiply";
            break;
          case "divide":
            if (previousResult && currentOperation !== operation) {
              newResult = previousResult / result;
              previousResult = 0;
            } else currentOperation = "divide";
            break;
          case "equal":
            solveMath(currentOperation);
            break;
          default:
            alert("invalid operator");
        }
        if (newResult) {
          document.getElementById("result").value = newResult;
        }
        if (operation !== "equal") {
          currentOperation = operation;
        } else {
          currentOperation = undefined;
        }

        startAgain = true;
        previousResult = newResult || Number(result);
      }

      function clearInput(isAll) {
        if (isAll) {
          previousResult = undefined;
          currentOperation = undefined;
          startAgain = false;
        }

        document.getElementById("result").value = 0;
      }

      function specialOperations(operation) {
        const result = Number(document.getElementById("result").value);
        switch (operation) {
          case "1/x":
            document.getElementById("result").value = 1 / result;
            break;
          case "x2":
            document.getElementById("result").value = result * result;
            break;
          case "squareroot":
            document.getElementById("result").value = Math.sqrt(result);
            break;
          default:
            console.log("invalid op");
        }
      }
    </script>
  </body>
</html>
